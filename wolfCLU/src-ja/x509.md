### X509 コマンド — 証明書の解析・表示および署名

`wolfssl x509` コマンドは、X.509 証明書および
証明書署名要求（Certificate Signing Request: CSR）を扱うための
汎用ユーティリティです。

本コマンドは **2 つの明確に異なる動作モード** を持っており、
`-req` オプションが指定されているかどうかによって
振る舞いが大きく変化します。

- **証明書解析・表示モード（デフォルト）**
- **CSR 処理・証明書生成モード（`-req` 指定時）**

インタフェースおよび全体的な挙動は OpenSSL の
`openssl x509` コマンドに意図的に近づけられており、
内部的には wolfSSL の X.509 解析および証明書処理実装に基づいて動作します。

主な用途は以下のとおりです。

- X.509 証明書の PEM / DER 形式変換
- 証明書内容の確認（Subject、Issuer、有効期間、公開鍵など）
- シリアル番号、フィンガープリント、ハッシュ値などの証明書メタ情報の表示
- CSR を入力として X.509 証明書を生成および署名

---

#### 動作モード

##### 証明書解析・表示モード（デフォルト）

`-req` オプションが指定されていない場合、入力ファイルは
**X.509 証明書** として扱われます。

このモードでは、既存の証明書に対する解析、表示、および形式変換が
主な目的となります。

主な操作内容は以下のとおりです。

- 人間可読形式での証明書内容の表示
- 特定の証明書フィールドの抽出（Subject、Issuer、有効期間など）
- 公開鍵または RSA モジュラスの出力
- PEM / DER 間での証明書形式変換

このモードでは **証明書の署名処理は行われません**。

##### 共通オプション

| オプション | 説明 |
|------|-------------|
| `-inform pem \| der` | 入力証明書の形式 |
| `-in <file>` | 入力証明書ファイル |
| `-outform pem \| der` | 出力証明書の形式 |
| `-out <file>` | 出力ファイル |
| `-noout` | エンコードされた証明書を出力しない |
| `-text` | 証明書を人間可読形式で表示 |
| `-subject` | Subject 識別名を表示 |
| `-issuer` | Issuer 識別名を表示 |
| `-serial` | 証明書のシリアル番号を 16 進数で表示 |
| `-dates` | 証明書の有効期間を表示 |
| `-email` | Subject に含まれるメールアドレスを表示 |
| `-fingerprint` | 証明書のフィンガープリント（DER エンコードのハッシュ）を表示 |
| `-purpose` | 証明書の用途を表示 |
| `-hash` | Subject 名のハッシュ値を表示 |
| `-modulus` | RSA 公開鍵のモジュラスを表示 |
| `-pubkey` | 公開鍵を出力 |

##### 例

```sh
wolfssl x509 -in cert.pem -text
wolfssl x509 -in cert.pem -subject -issuer -dates
wolfssl x509 -inform pem -in cert.pem -outform der -out cert.der
```

##### CSR 処理・証明書生成モード（`-req`）

`-req` オプションが指定されると、入力ファイルは証明書ではなく  
**証明書署名要求（Certificate Signing Request: CSR）** として解釈されます。

このモードでは、`wolfssl x509` は以下の用途に使用できます。

- CSR の処理および内容確認  
- CSR に基づく X.509 証明書の生成および署名  
- 設定ファイルからの証明書拡張の適用  
- 署名に使用するダイジェストアルゴリズムの選択  

`-signkey`、ダイジェスト指定（`-sha256` など）、  
`-extfile`、`-extensions` といったオプションは、  
**このモードでのみ意味を持ちます**。

---

###### 注意事項

- `-in` で指定された入力ファイルの意味は、`-req` の有無によって異なります。  
- 一部のオプションは特定の動作モードでのみ有効であり、  
  他のモードでは無視されるか、無効となります。  
- CSR 自体を生成する場合は、専用の `req` コマンドを使用してください。

---

###### CSR 専用オプション

以下のオプションは、**`-req` が指定されている場合にのみ有効**です。

| オプション | 説明 |
|------|-------------|
| `-req` | CSR 処理モードを有効化 |
| `-signkey <file>` | 生成される証明書の署名に使用する秘密鍵 |
| `-*`（例: `-sha256`, `-sha384`） | 証明書署名に使用するダイジェストアルゴリズム |
| `-extfile <file>` | X.509 拡張を定義した設定ファイル |
| `-extensions <section>` | 使用する拡張定義セクション名 |

証明書表示関連のオプション（`-issuer`、`-serial`、`-dates` など）は、  
このモードでは一般的に適用されません。

---

###### 例

SHA-256 を用いて CSR から X.509 証明書を生成し、  
拡張情報を設定ファイルから適用する例を示します。

```sh
wolfssl x509 -req \
  -in server.csr \
  -signkey ca-key.pem \
  -sha256 \
  -extfile cert.conf \
  -extensions v3_server \
  -out server-cert.pem
```