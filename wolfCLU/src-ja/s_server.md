### S_SERVER コマンド — TLS サーバ起動および動作確認

`wolfssl s_server` コマンドは、指定した証明書と秘密鍵を用いて
**簡易的な TLS/SSL サーバを起動するための診断用ユーティリティ**です。

本コマンドは OpenSSL の `openssl s_server` コマンドと同様の用途を持ち、
主に以下のような目的で使用されます。

- TLS サーバ側の動作確認
- 証明書および秘密鍵の正当性確認
- クライアント証明書検証のテスト
- TLS バージョンネゴシエーションの確認
- `s_client` などを用いた相互接続テスト

---

#### 機能概要

`s_server` コマンドは、指定されたポートで待ち受けを行い、
クライアントからの接続を受け付けて TLS ハンドシェイクを実行します。

オプションに応じて、以下のような動作が可能です。

- 指定した証明書・秘密鍵による TLS サーバ起動
- クライアント証明書検証の有効／無効切り替え
- 使用する TLS バージョンの制限
- 複数回の接続受付
- 簡易的な HTTP（HTML）レスポンスの送信

本コマンドは **テスト・検証用途**を目的としており、
本番環境向けの高機能なサーバ実装ではありません。

---

#### 入出力

- **入力**
  - サーバ証明書（PEM 形式）
  - サーバ秘密鍵（PEM 形式）
  - （任意）クライアント証明書検証用 CA 証明書
- **出力**
  - 接続状況および TLS ハンドシェイクに関する情報（標準出力）

---

#### 共通オプション

| オプション | 説明 |
|------|-------------|
| `-port <int>` | 待ち受ける TCP ポート番号 |
| `-key <file>` | サーバ秘密鍵ファイル（PEM 形式のみ対応） |
| `-cert <file>` | サーバ証明書ファイル（PEM 形式のみ対応） |
| `-CAfile <file>` | クライアント証明書検証に使用する CA 証明書（PEM 形式のみ） |
| `-noVerify` | クライアント証明書検証を無効化 |
| `-version <int>` | 使用する SSL/TLS バージョンを指定 |
| `-naccept <int>` | 接続を受け付ける回数（デフォルト: 1） |
| `-www` | HTTP 形式（HTML）のレスポンスを返す |
| `-readyFile <file>` | サーバ起動完了を通知するファイルを作成 |

---

#### TLS バージョン指定（-version）

`-version` オプションを使用することで、
受け付ける SSL/TLS バージョンを制限できます。

| 値 | 対応プロトコル |
|----|----------------|
| `0` | SSLv3 |
| `1` | TLS 1.0 |
| `2` | TLS 1.1 |
| `3` | TLS 1.2 |
| `4` | TLS 1.3 |

> **注意:**  
> 実際に使用可能なプロトコルは、wolfSSL のビルド構成によって異なります。

---

#### クライアント証明書検証

- デフォルトでは、クライアント証明書の検証が有効です。
- `-noVerify` を指定すると、クライアント証明書は要求・検証されません。
- クライアント証明書を検証する場合は、
  `-CAfile` で信頼する CA 証明書を指定する必要があります。

---

#### 注意事項

- `-key` および `-cert` オプションで指定するファイルは
  **PEM 形式のみ対応**しています。
- 本コマンドは単純な TLS サーバであり、
  高負荷・高機能なサーバ用途には適していません。
- `-www` オプションは、TLS 接続確認を容易にするための簡易機能です。
- `-readyFile` は、外部監視ツールなどから
  サーバ起動完了を検知するために使用できます。

---

#### 例

TLS サーバをポート 4433 で起動する例:

```sh
wolfssl s_server \
  -port 4433 \
  -cert server-cert.pem \
  -key server-key.pem
```

TLS 1.2 のみを使用するサーバを起動する例:

```sh
wolfssl s_server \
  -port 4433 \
  -cert server-cert.pem \
  -key server-key.pem \
  -version 3
```

クライアント証明書検証を無効にする例:

```sh
wolfssl s_server \
  -port 4433 \
  -cert server-cert.pem \
  -key server-key.pem \
  -noVerify
```

複数回の接続を受け付ける例:

```sh
wolfssl s_server \
  -port 4433 \
  -cert server-cert.pem \
  -key server-key.pem \
  -naccept 10
```
