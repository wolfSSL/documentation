### GENKEY コマンド — 暗号鍵の生成

`wolfssl genkey` コマンドは、対応する暗号アルゴリズムについて、
公開鍵／秘密鍵のペア、または個別の公開鍵・秘密鍵を生成するために使用されます。

本コマンドは OpenSSL の `genpkey` や関連コマンドと同様の思想に基づいた、
鍵生成のための統一インタフェースを提供しますが、
オプション体系はより簡潔かつ明示的になっています。

サポートされる鍵種別は wolfSSL のビルド構成に依存します。
デフォルト構成では、以下の鍵種別が利用可能です。

- `rsa`
- `ecc`
- `ed25519`
- `dilithium`
- `xmssmt`
- `xmss`

---

#### 機能概要

`genkey` コマンドは、以下の鍵生成操作をサポートします。

- 公開鍵／秘密鍵ペアの生成
- 秘密鍵のみの生成
- 公開鍵のみの生成
- 鍵の PEM / DER 形式での出力

鍵ペアを生成する場合、公開鍵と秘密鍵は別々のファイルとして出力され、
ファイル名のサフィックスによって区別されます。

---

#### サポートされている鍵種別

| 鍵種別 | 説明 |
|---------|-------------|
| `rsa` | RSA 公開鍵／秘密鍵ペア |
| `ecc` | 楕円曲線暗号（ECC）鍵 |
| `ed25519` | Ed25519 署名鍵 |

> **注意:**  
> 利用可能な鍵種別は、wolfSSL の構成およびビルド方法に依存します。

---

#### 共通オプション

| オプション | 説明 |
|------|-------------|
| `<keytype>` | 生成する鍵の種別（`rsa`, `ecc`, `ed25519`） |
| `-size <bits>` | 鍵サイズ（ビット単位、RSA のみ、任意） |
| `-out <filename>` | 出力ファイルのベース名 |
| `-outform PEM \| DER` | 生成される鍵の出力形式 |
| `-output <PUB \| PRIV \| KEYPAIR>` | 生成する鍵の種類を指定 |

---

#### 出力仕様

出力されるファイルは、`-output` オプションの値によって決定されます。

| `-output` の値 | 生成されるファイル |
|----------------|--------------------|
| `KEYPAIR` | `<filename>.priv` および `<filename>.pub` |
| `PRIV` | `<filename>.priv` |
| `PUB` | `<filename>.pub` |

ファイル拡張子は、`-out` で指定されたベース名に自動的に付与されます。

---

#### 注意事項

- `-size` が指定されていない場合、適用可能な場合にはデフォルトの鍵サイズが使用されます。
- `-size` オプションは RSA 鍵にのみ適用されます。
- ECC および Ed25519 鍵では、使用される曲線はビルド構成または内部のデフォルト設定によって決定されます。
- 生成された鍵はファイルに直接出力され、対話的な入力は行われません。

---

#### 例

DER 形式で RSA 鍵ペアを生成する例:

```sh
wolfssl genkey rsa -size 2048 -out mykey -outform der -output KEYPAIR
```

#### RSA 固有オプション

以下のオプションは、RSA 鍵生成時にのみ有効です。

| オプション | 説明 |
|------|-------------|
| `-exponent <value>` | RSA 公開指数を指定します（例: `65537`） |

> **注意:**  
> `-exponent` オプションは RSA 鍵生成時にのみ適用されます。  
> 指定されていない場合は、デフォルトの公開指数が使用されます。

##### 例

カスタム公開指数を指定して RSA 鍵ペアを生成する例:

```sh
wolfssl genkey rsa -size 2048 -exponent 65537 -out mykey -outform pem -output KEYPAIR
```

#### 耐量子およびハッシュベース鍵種別

ビルド構成によっては、`genkey` コマンドは
**耐量子暗号（Post-Quantum Cryptography: PQC）** および
**ハッシュベース署名アルゴリズム** をサポートします。

これらの鍵種別は、量子計算機の出現を想定した将来耐性を目的としており、
従来の公開鍵暗号とは異なる特性と運用上の注意点を持ちます。

---

##### Dilithium（耐量子署名）

Dilithium は、格子暗号に基づく耐量子署名アルゴリズムです。

| オプション | 説明 |
|------|-------------|
| `dilithium` | Dilithium 耐量子署名鍵を生成 |
| `-level <2 \| 3 \| 5>` | Dilithium 鍵のセキュリティレベル |

サポートされるセキュリティレベルは以下のとおりです。

- レベル 2
- レベル 3
- レベル 5

指定されたレベルにより、セキュリティ強度および鍵サイズが決定されます。
一般に、レベルが高くなるほど安全性は向上しますが、
鍵サイズおよび計算コストも増加します。

---

##### XMSSMT（マルチツリー XMSS）

XMSSMT は、ハッシュベース署名方式である XMSS を
マルチツリー構造に拡張したアルゴリズムです。

| オプション | 説明 |
|------|-------------|
| `xmssmt` | XMSS マルチツリー（XMSSMT）鍵を生成 |
| `-height <20 \| 40 \| 60>` | ツリー全体の高さ |
| `-layer <value>` | マルチツリー構造におけるレイヤ数 |

`-layer` に指定可能な値は、選択したツリー高さに依存します。

- 高さ 20 または 40 の場合: `2`, `4`, `8`
- 高さ 60 の場合: `3`, `6`, `12`

> **注意:**  
> ツリー全体の高さは、レイヤ数で割り切れる必要があります。

---

##### XMSS（シングルツリー XMSS）

XMSS は、単一ツリー構造を持つハッシュベース署名アルゴリズムです。

| オプション | 説明 |
|------|-------------|
| `xmss` | シングルツリー XMSS 鍵を生成 |
| `-height <10 \| 16 \| 20>` | ツリーの高さ |

サポートされるツリー高さは以下のとおりです。

- 10
- 16
- 20

ツリーの高さは、1 つの XMSS 鍵で生成可能な
**署名回数の上限** を決定します。

---

#### 耐量子鍵生成に関する注意事項

- 耐量子暗号およびハッシュベース署名アルゴリズムの利用可否は、
  wolfSSL のビルド構成および有効化された機能に依存します。
- ツリー高さやセキュリティレベルを大きくすると、
  鍵サイズが増大し、計算コストも増加します。
- XMSS および XMSSMT 鍵は **生成可能な署名回数に上限がある** ため、
  鍵の再利用回数を厳密に管理し、鍵枯渇を防ぐ必要があります。

---

##### 例

Dilithium レベル 3 の鍵ペアを生成する例:

```sh
wolfssl genkey dilithium -level 3 -out pqkey -outform pem -output KEYPAIR
```

高さ 40、レイヤ数 4 の XMSSMT 鍵を生成する例:

```sh
wolfxsl genkey xmssmt -height 40 -layer 4 -out xmssmtkey -outform pem -output KEYPAIR
```

高さ 16 の XMSS 鍵を生成する例:

```sh
wolfssl genkey xmss -height 16 -out xmsskey -outform pem -output KEYPAIR
```
