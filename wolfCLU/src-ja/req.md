### REQ コマンド — 証明書要求および自己署名証明書の生成

`wolfssl req` コマンドは、  
**証明書署名要求（Certificate Signing Request: CSR）** の生成および処理、ならびに
オプションとして **自己署名 X.509 証明書** を生成するために使用されます。

本コマンドは OpenSSL の `openssl req` コマンドと同様の機能を提供し、
主に以下の用途を想定しています。

- 新しい証明書署名要求（CSR）の生成
- CSR に使用する秘密鍵の生成
- 自己署名 X.509 証明書の生成
- 既存 CSR の検証および内容確認

コマンドの挙動は指定されるオプションの組み合わせ、
特に `-newkey`、`-inkey`、`-x509` によって決まります。

---

#### 機能概要

`req` コマンドは、以下の主なユースケースをサポートします。

- **CSR の生成**
  - 既存の秘密鍵を使用
  - リクエスト生成時に新しい秘密鍵を生成
- **自己署名証明書の生成**
  - CSR に基づいて X.509 証明書を直接生成
- **CSR の確認および検証**
  - CSR 内容の表示
  - CSR に付与された署名の検証

証明書の Subject 情報および拡張情報は、
対話的入力または設定ファイルのいずれかで指定できます。

---

### 共通オプション

| オプション | 説明 |
|------|-------------|
| `-in <file>` | 読み込む入力ファイル |
| `-out <file>` | 出力先ファイル（省略時は標準出力） |
| `-inform der \| pem` | `-in` で指定した入力ファイルの形式 |
| `-outform der \| pem` | `-out` で指定した出力形式 |
| `-config <file>` | 証明書要求の設定を記述した設定ファイル |
| `-subj <subject>` | コマンドラインで Subject 名を指定 |
| `-text` | CSR を人間可読形式で出力 |
| `-noout` | エンコードされた CSR または証明書を出力しない |

---

#### 鍵および CSR 生成関連オプション

これらのオプションは、秘密鍵および CSR の生成方法を制御します。

| オプション | 説明 |
|------|-------------|
| `-newkey <type>` | リクエスト用の新しい秘密鍵を生成 |
| `-keyout <file>` | 新しく生成した秘密鍵の出力先 |
| `-nodes` | 出力される秘密鍵を暗号化しない |
| `-inkey <file>` | 既存の秘密鍵を使用 |
| `-key <file>` | 証明書要求に含める公開鍵 |

---

#### 自己署名証明書関連オプション

| オプション | 説明 |
|------|-------------|
| `-x509` | CSR の代わりに自己署名 X.509 証明書を生成 |
| `-days <n>` | 証明書の有効日数 |
| `-extensions <section>` | 設定ファイル内で使用する拡張定義セクション |

---

#### 検証関連オプション

| オプション | 説明 |
|------|-------------|
| `-verify` | CSR に付与された署名を検証 |

---

#### 注意事項

- `-x509` を指定した場合、出力は CSR ではなく X.509 証明書になります。
- `-newkey` オプションは、新しい秘密鍵を生成し、それを CSR に関連付けます。
- `-newkey` と `-inkey` のいずれも指定されていない場合、
  コマンドは他の手段で鍵が提供されることを前提とします。
- CSR を CA 鍵で署名する場合は、`x509 -req` コマンドを使用してください。

---

#### 例

新しい CSR と秘密鍵を生成する例:

```sh
wolfssl req -newkey rsa:2048 -keyout server.key -out server.csr
```

自己署名証明書を生成する例:

```sh
wolfssl req -x509 -newkey rsa:2048 -days 365 \
  -keyout server.key -out server.crt
```

既存 CSR の内容を表示する例:

```sh
wolfssl req -in server.csr -text
```

CSR の署名を検証する例:

```sh
wolfssl req -in server.csr -verify
```

